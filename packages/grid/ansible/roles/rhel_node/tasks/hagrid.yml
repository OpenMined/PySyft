---
- name: Add /home/{{ om_user }}/.local/bin to PATH in .profile
  ansible.builtin.lineinfile:
    create: true
    path: "/home/{{ om_user }}/.profile"
    line: 'export PATH="$HOME/.local/bin:$PATH"'
    insertafter: EOF
    state: present
  become: yes

- name: Install HAGrid
  shell: "runuser -l {{ om_user }} -c 'pip install -e {{ syft_dir }}/packages/hagrid'"
  become: yes
  when: vagrant is defined

# Check if home_dir exists
- name: Check if home_dir exists
  ansible.builtin.stat:
    path: "{{ om_homedir }}"
  register: home_dir
  become: yes
  when: vagrant is defined and install == "true"

#Set permissions on home_dir
- name: Set permissions on home_dir
  ansible.builtin.file:
    path: "{{ om_homedir }}"
    owner: "{{ om_user }}"
    group: "{{ om_group }}"
    mode: 0755
    recurse: yes
  become: yes
  when: vagrant is defined and install == "true"

- name: Install HAGrid (temp root)
  shell: "pip install -e {{ syft_dir }}/packages/hagrid"
  become: yes
